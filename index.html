<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Game "Life"</title>
</head>

<body>
  <canvas id="game"></canvas>
  <script>
    class Game {
      constructor() {
        this.cellSize = 10
        this.cellNumberX = 100
        this.cellNumberY = 100
        this.canvas = document.getElementById('game')
        this.ctx = this.canvas.getContext('2d')
        this.area = Array(this.cellNumberX).fill(false).map(() => Array(this.cellNumberY).fill(false));
      }

      init() {
        this.canvas.setAttribute("width", this.cellNumberX * this.cellSize)
        this.canvas.setAttribute("height", this.cellNumberY * this.cellSize)
        const initCellProbability = 0.25
        for (let x = 0; x < this.cellNumberX; x++) {
          for (let y = 0; y < this.cellNumberY; y++) {
            if (Math.random() < initCellProbability) {
              this.area[x][y] = true
            }
          }
        }
      }

      update() {

      }

      countNeighbours(x, y) {
        const neighboursDiff = [
          { 'x': -1, 'y': -1 },
          { 'x': 0, 'y': -1 },
          { 'x': 1, 'y': -1 },

          { 'x': -1, 'y': 0 },
          { 'x': 1, 'y': 0 },

          { 'x': -1, 'y': 1 },
          { 'x': 0, 'y': 1 },
          { 'x': 1, 'y': 1 },
        ]
        const neighboursCount = neighboursDiff
          .map((diff) => {
            const neighbourX = x + diff.x
            const neighbourY = y + diff.y
            if (neighbourX < 0) return false
            if (neighbourX >= this.cellNumberX) return false
            if (neighbourY < 0) return false
            if (neighbourY >= this.cellNumberY) return false
            return this.area[neighbourX][neighbourY]
          })
          .filter(it => it)
          .length

        return neighboursCount
      }

      draw() {
        for (let x = 0; x < this.cellNumberX; x++) {
          for (let y = 0; y < this.cellNumberY; y++) {
            if (this.area[x][y]) {
              this.drawCell(x, y)
              console.log(this.countNeighbours(x, y))
            }
          }
        }
      }

      drawCell(x, y) {
        this.ctx.fillStyle = 'black'
        this.ctx.fillRect(x * this.cellSize, y * this.cellSize, this.cellSize, this.cellSize)
      }
    }

    const game = new Game()
    game.init()
    game.draw()
  </script>
</body>

</html>